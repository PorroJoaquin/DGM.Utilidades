<!DOCTYPE HTML>
<html>

<head>
	<title>Calculadora de Viajes</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<link rel="stylesheet" href="assets/css/calculadora-de-viajes.css">

	<script defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdzoq2lq-NbzjAug4H2uVgTGnogG1c2F4&callback=initMap&libraries=places"></script>
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" />
	</noscript>
</head>

<body class="is-preload">
	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header -->
		<header id="header">
			<div class="inner">

				<!-- Logo -->
				<a href="index.html" class="logo">
					<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">DGM
						Utilidades</span>
				</a>

				<!-- Nav -->
				<nav>
					<ul>
						<li><a href="#menu">Menu</a></li>
					</ul>
				</nav>

			</div>
		</header>

		<!-- Menu -->
		<nav id="menu">
			<h2>Menu</h2>
			<ul>
				<li><a href="index.html">Home</a></li>
				<li><a href="calculadora_de_viajes.html">Calculadora de Viajes</a></li>
			</ul>
		</nav>

		<!-- Main -->
		<div id="main">
			<div class="inner">
				<h1> Calculadora de Viajes</h1>
				<!-- <p>Donec eget ex magna. Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque
					venenatis dolor imperdiet dolor mattis sagittis. Praesent rutrum sem diam, vitae egestas enim auctor
					sit amet. Pellentesque leo mauris, consectetur id ipsum sit amet, fergiat. Pellentesque in mi eu
					massa lacinia malesuada et a elit. Donec urna ex, lacinia in purus ac, pretium pulvinar mauris.
					Curabitur sapien risus, commodo eget turpis at, elementum convallis elit. Pellentesque enim turpis,
					hendrerit tristique.</p> -->
				<!-- <br> -->
			</div>
			<section id="one" class="wrapper style2">

				<br>
				<h6 class="subhead">Origen </h6>
				<br>
				<div id="direccion-inputs">
					<input value="Fitz Roy 201, Buenos Aires, Argentina" class="direccion" id="primer-direccion"
						type="text" placeholder="Ingresá una Direccion">
				</div>

				<br>
				<h6 class="subhead">Destino </h6>
				<br>
				<div id="direccion-inputs">
					<input value="Fitz Roy 201, Buenos Aires, Argentina" class="direccion" id="segunda-direccion"
						type="text" placeholder="Ingresá una Direccion">
				</div>

				<br>
				<h6 class="subhead">Paradas </h6>
				<br>
				<div id="direccion-inputs">
					<input class="direccion" id="tercera-direccion" type="text" placeholder="Ingresá una Direccion">

					<input class="direccion" id="cuarta-direccion" type="text" placeholder="Ingresá una Direccion">

					<input class="direccion" id="quinta-direccion" type="text" placeholder="Ingresá una Direccion">
				</div>

				<br>
				<h6 class="subhead">Utilitario</h6>
				<br>
				<div class="checklist">
					<input type="radio" id="Chico" name="utilitario" value="C" checked>
					<label for="Chico">Pequeño</label><br>

					<input type="radio" id="Mediano" name="utilitario" value="M">
					<label for="Mediano">Mediano</label><br>

				</div>
				<br>
				<h6 class="subhead">Carga Explosiva</h6>
				<br>
				<div class="checklist">
					<input type="radio" id="c1" name="explosivo" value="No" checked>
					<label for="c1">No </label><br>

					<input type="radio" id="c2" name="explosivo" value="Si">
					<label for="c2">Si </label><br>
				</div>
				<br>
				<br>
				<button id="calcular-distancia" onclick="calcular_distancia()">Calcular</button>
				<br><br><br>
				<div id="map"></div>
				<div> </div>
				<br>
				<div class="table-wrapper">
					<table class="alt">
						<thead>
							<tr>
								<th colspan="2" style="text-align: center; background-color: cornflowerblue;">Resultado
								</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Distancia Total</td>
								<td id="output-distancia"></td>
							</tr>
							<tr>
								<td>Distancia Zona 1</td>
								<td id="output-zona-1"></td>
							</tr>
							<tr>
								<td>Distancia Zona 2</td>
								<td id="output-zona-2"></td>
							</tr>
							<tr>
								<td>Recorrido</td>
								<td id="recorrido"></td>
							</tr>
							<tr>
								<td>Choferes</td>
								<td id="choferes"></td>
							</tr>
							<tr>
								<td>Precio en Dolares</td>
								<td id="costo-dolares"></td>
							</tr>
							<tr>
								<td>Tipo de Cambio</td>
								<td id="tipo-de-cambio"></td>
							</tr>
							<tr>
								<td>Precio en Pesos</td>
								<td id="costo-pesos"></td>
							</tr>
						</tbody>
						<!-- <tfoot>
							<tr>
								<td colspan="1"></td>
								<td>100.00</td>
							</tr>
						</tfoot> -->
					</table>
				</div>
			</section>
		</div>

		<!-- Footer -->
		<footer id="footer">
			<div class="inner">
				<section>
					<h2>Get in touch</h2>
					<form method="post" action="#">
						<div class="fields">
							<div class="field half">
								<input type="text" name="name" id="name" placeholder="Name" />
							</div>
							<div class="field half">
								<input type="email" name="email" id="email" placeholder="Email" />
							</div>
							<div class="field">
								<textarea name="message" id="message" placeholder="Message"></textarea>
							</div>
						</div>
						<ul class="actions">
							<li><input type="submit" value="Send" class="primary" /></li>
						</ul>
					</form>
				</section>
				<section>
					<h2>Follow</h2>
					<ul class="icons">
						<li><a href="#" class="icon brands style2 fa-twitter"><span class="label">Twitter</span></a>
						</li>
						<li><a href="#" class="icon brands style2 fa-facebook-f"><span class="label">Facebook</span></a>
						</li>
						<li><a href="#" class="icon brands style2 fa-instagram"><span class="label">Instagram</span></a>
						</li>
						<li><a href="#" class="icon brands style2 fa-dribbble"><span class="label">Dribbble</span></a>
						</li>
						<li><a href="#" class="icon brands style2 fa-github"><span class="label">GitHub</span></a></li>
						<li><a href="#" class="icon brands style2 fa-500px"><span class="label">500px</span></a></li>
						<li><a href="#" class="icon solid style2 fa-phone"><span class="label">Phone</span></a></li>
						<li><a href="#" class="icon solid style2 fa-envelope"><span class="label">Email</span></a></li>
					</ul>
				</section>
				<ul class="copyright">
					<li>&copy; Untitled. All rights reserved</li>
					<li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
				</ul>
			</div>
		</footer>

	</div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

	<script>
		let map; let directionsService; let directionsRenderer, input_1_ac, input_2_ac, input_3_ac, input_4_ac, input_5_ac, dolar_oficial, recorrido;

		function initMap() {

			google.maps.event.addDomListener(window, "load", () => {

				let options = {
					formatted_address: "Fitz Roy 201, C1414 Cdad. Autónoma de Buenos Aires, Argentina",
					geometry: {
						"location": {
							"lat": -34.5965912,
							"lng": -58.4517827
						},
						"viewport": {
							"south": -34.59789593029149,
							"west": -58.45318218029151,
							"north": -34.59519796970849,
							"east": -58.4504842197085
						}
					},
					name: "Fitz Roy 201",

				}

				input_1_ac = new google.maps.places.Autocomplete(document.getElementById("primer-direccion"));
				input_2_ac = new google.maps.places.Autocomplete(document.getElementById("segunda-direccion"));
				input_3_ac = new google.maps.places.Autocomplete(document.getElementById("tercera-direccion"));
				input_4_ac = new google.maps.places.Autocomplete(document.getElementById("cuarta-direccion"));
				input_5_ac = new google.maps.places.Autocomplete(document.getElementById("quinta-direccion"));
			});


			map = new google.maps.Map(document.getElementById("map"), { center: { lat: 39.7392, lng: -104.9903 }, zoom: 3, });

			directionsService = new google.maps.DirectionsService();
			directionsRenderer = new google.maps.DirectionsRenderer();


			directionsRenderer.setMap(map);

			fetch("https://dolarapi.com/v1/dolares/oficial")
				.then(response => response.json())
				.then(data => dolar_oficial = data.venta);
		}

		function agregar_input() { }

		function printPlace() {
			let i1 = input_1_ac.getPlace().geometry.location;
			let i2 = input_2_ac.getPlace().geometry.location;
			console.log(i1.lng());
			console.log(i1.lat());
			console.log(i2.lng());
			console.log(i2.lat());
			console.log(i1.lng() - i2.lng());
			console.log(input_1_ac.getPlace())
		}

		function formula_costos(utilitario, km_zona_1, km_zona_2, explosivos) {
			const ZONA_1_UTILITARIOS_CHICO = 0.94;
			const ZONA_1_UTILITARIOS_MEDIANO = 1.34;
			const ZONA_1_CONDUCTOR_ADICIONAL = 0.43;

			const ZONA_2_UTILITARIOS_CHICO = 1.03;
			const ZONA_2_UTILITARIOS_MEDIANO = 1.43;
			const ZONA_2_CONDUCTOR_ADICIONAL = 0.52;

			let costo = 0;

			if (utilitario === "C") {
				costo += km_zona_1 * ZONA_1_UTILITARIOS_CHICO + km_zona_2 * ZONA_2_UTILITARIOS_CHICO
			} else if (utilitario === "M") {
				costo += km_zona_1 * ZONA_1_UTILITARIOS_MEDIANO + km_zona_2 * ZONA_2_UTILITARIOS_MEDIANO
			}

			if (explosivos) {
				costo += km_zona_1 * ZONA_1_CONDUCTOR_ADICIONAL + km_zona_2 * ZONA_2_CONDUCTOR_ADICIONAL;
			}

			return costo;

		}

		function calcular_distancia() {

			var iv1 = document.getElementById("primer-direccion").value;
			var iv2 = document.getElementById("segunda-direccion").value;
			var iv3 = document.getElementById("tercera-direccion").value;
			var iv4 = document.getElementById("cuarta-direccion").value;
			var iv5 = document.getElementById("quinta-direccion").value;

			const waypoints = [];
			recorrido = [];

			// Add non-empty waypoints to the waypoints array
			if (iv1) {
				console.log("Adding waypoint for input 1");
				let i1 = input_1_ac.getPlace().geometry.location;
				waypoints.push({
					location: new google.maps.LatLng(i1.lat(), i1.lng()),
					stopover: true
				});
			} else {
				console.log("Input 1 is empty");
			}

			if (iv2) {
				console.log("Adding waypoint for input 2");
				let i2 = input_2_ac.getPlace().geometry.location;
				waypoints.push({
					location: new google.maps.LatLng(i2.lat(), i2.lng()),
					stopover: true
				});
			} else {
				console.log("Input 2 is empty");
			}

			if (iv3) {
				console.log("Adding waypoint for input 3");
				let i3 = input_3_ac.getPlace().geometry.location;
				waypoints.push({
					location: new google.maps.LatLng(i3.lat(), i3.lng()),
					stopover: true
				});
				recorrido.push(input_3_ac.getPlace().address_components[0].long_name);

			} else {
				console.log("Input 3 is empty");
			}

			if (iv4) {
				console.log("Adding waypoint for input 4");
				let i4 = input_4_ac.getPlace().geometry.location;
				waypoints.push({
					location: new google.maps.LatLng(i4.lat(), i4.lng()),
					stopover: true
				});
				recorrido.push(input_4_ac.getPlace().address_components[0].long_name);
			} else {
				console.log("Input 4 is empty");
			}

			if (iv5) {
				console.log("Adding waypoint for input 5");
				let i5 = input_5_ac.getPlace().geometry.location;
				waypoints.push({
					location: new google.maps.LatLng(i5.lat(), i5.lng()),
					stopover: true
				});
				recorrido.push(input_5_ac.getPlace().address_components[0].long_name);
			} else {
				console.log("Input 5 is empty");
			}

			const request = {
				origin: waypoints[0].location,
				destination: waypoints[1].location,
				waypoints: waypoints.slice(2),
				optimizeWaypoints: false,
				travelMode: google.maps.TravelMode.DRIVING,
			};

			directionsService.route(request, function (response, status) {
				if (status === google.maps.DirectionsStatus.OK) {
					directionsRenderer.setDirections(response);
					var northernDistance = 0;
					var southernDistance = 0;
					var totalDistance = 0;
					var referenceLatitude = -39; // Your reference latitude

					var legs = response.routes[0].legs;
					for (var i = 0; i < legs.length; i++) {
						var leg = legs[i];
						var steps = leg.steps;

						for (var j = 0; j < steps.length; j++) {
							var step = steps[j];
							totalDistance += step.distance.value;

							var midLatitude = (step.start_location.lat() + step.end_location.lat()) / 2;
							if (midLatitude > referenceLatitude) {
								northernDistance += step.distance.value;
							} else {
								southernDistance += step.distance.value;
							}
						}
					}

					// Convert meters to kilometers and update output
					northernDistance = northernDistance / 1000;
					southernDistance = southernDistance / 1000;
					totalDistance = totalDistance / 1000;

					document.getElementById('output-distancia').innerHTML = Math.ceil(totalDistance) + " km";

					document.getElementById('output-zona-1').innerHTML = Math.ceil(northernDistance) + " km";

					document.getElementById('output-zona-2').innerHTML = Math.ceil(southernDistance) + " km";

					const utilitarioRadio = document.querySelector('input[name="utilitario"]:checked'); // Select checked radio for "fav_language"
					const explosivoRadio = document.querySelector('input[name="explosivo"]:checked'); // Select checked radio for "explosivo"



					let recorrido_string = recorrido.join(" -> ");

					document.getElementById('recorrido').innerHTML = recorrido_string;

					let utilitario = utilitarioRadio.value;
					let explosivo = explosivoRadio.value === "Si";

					// console.log("Explosivo: " + explosivo);

					let costo_dolares = formula_costos(utilitario, northernDistance, southernDistance, explosivo);
					let costo_pesos = (dolar_oficial * costo_dolares);

					let choferes = 1;

					if (explosivo) {
						choferes = 2
					}

					document.getElementById('choferes').innerHTML = choferes;

					document.getElementById('costo-dolares').innerHTML = Math.ceil(costo_dolares) + " USD + IVA";

					document.getElementById('tipo-de-cambio').innerHTML = dolar_oficial + " pesos";

					document.getElementById('costo-pesos').innerHTML = Math.ceil(costo_pesos) + " USD + IVA";

				} else {
					console.error("Directions request failed. Status:", status);
				}
			});
		}
	</script>

</body>

</html>